#include "NTT.h"

const int streamlined_Rmod_root_table[NTT_N << 1] = {
1, 1, 1446600, 1, -472199, -2407952, 4615052, -2306475, -2306475, -472199, -2306475, -472199, -2407952, 4615052, -472199, -2407952, 4615052, 2297035, 1243860, 1267824, 4046753, -2407952, 2297035, 1243860, -888160, 2154418, -3730163, 3693213, 4615052, 1267824, 4046753, -3612633, 3520751, 315286, -1996760, 2297035, -888160, 2154418, 162527, -642826, 4925916, 4169220, 1243860, -3730163, 3693213, 5019420, -1461373, 2223877, 2569528, 1267824, -3612633, 3520751, -4223018, 4669025, -3981072, 2377431, 4046753, 315286, -1996760, -4670707, -1946952, 4447077, 1986537, -2306475, -2306475, -472199, -2306475, -472199, -2407952, 4615052, -472199, -2407952, 4615052, 2297035, 1243860, 1267824, 4046753, -2407952, 2297035, 1243860, -888160, 2154418, -3730163, 3693213, 4615052, 1267824, 4046753, -3612633, 3520751, 315286, -1996760, 2297035, -888160, 2154418, 162527, -642826, 4925916, 4169220, 1243860, -3730163, 3693213, 5019420, -1461373, 2223877, 2569528, 1267824, -3612633, 3520751, -4223018, 4669025, -3981072, 2377431, 4046753, 315286, -1996760, -4670707, -1946952, 4447077, 1986537, -888160, 162527, -642826, 4977846, -704725, -4093639, -3579629, 2154418, 4925916, 4169220, 3377743, 1213221, -880843, -267778, -3730163, 5019420, -1461373, 1492521, -2307074, 1055952, -4800105, 3693213, 2223877, 2569528, -1001561, -2602282, 586314, -1256294, -3612633, -4223018, 4669025, 2592742, -3995678, -3307394, -233597, 3520751, -3981072, 2377431, -749037, 153964, 3042836, -406759, 315286, -4670707, -1946952, 672934, -2047017, 4106728, -2081957, -1996760, 4447077, 1986537, -1609143, -2375027, -4360838, -418845, 162527, 4977846, -704725, 90240, 2687317, -188467, 4021243, -642826, -4093639, -3579629, -3715784, 2329122, 3311108, -1202185, 4925916, 3377743, 1213221, 4645353, -2396236, 1087697, -3935604, 4169220, -880843, -267778, -1107830, 4386266, 3512589, 1386462, 5019420, 1492521, -2307074, 3853799, 3057304, 1758789, -3693476, -1461373, 1055952, -4800105, 621411, -2175379, -2661865, -4757867, 2223877, -1001561, -2602282, 3995275, 3317576, 2538847, -3678547, 2569528, 586314, -1256294, -4458233, 2196155, 4454547, -511065, -4223018, 2592742, -3995678, -3627135, -1961117, 985941, 105167, 4669025, -3307394, -233597, -2367522, -576824, 4922508, -4609683, -3981072, -749037, 153964, 2129720, -489490, -517853, -1635299, 2377431, 3042836, -406759, 3914986, 4408469, -778687, 690690, -4670707, 672934, -2047017, 3697195, -2507866, 2358421, -1383892, -1946952, 4106728, -2081957, -1819910, -2820819, -273053, -1518423, 4447077, -1609143, -2375027, 4173448, 2527973, -2346956, 1390188, 1986537, -4360838, -418845, 1028602, 1838531, -2710545, 1737387, 4977846, 90240, 2687317, 157199, 799092, -357196, -238288, -704725, -188467, 4021243, -2940764, 617303, -1847281, 3630836, -4093639, -3715784, 2329122, -2618345, 1748518, -1695271, -4392087, -3579629, 3311108, -1202185, 4762669, -161035, -26755, 1872558, 3377743, 4645353, -2396236, -1153170, 1802607, 1106927, -2362576, 1213221, 1087697, -3935604, 1045367, 153601, -2391472, 3267915, -880843, -1107830, 4386266, 4015034, -4776217, -3330522, -4884545, -267778, 3512589, 1386462, -4237798, -412723, 3274283, -4167396, 1492521, 3853799, 3057304, 3743694, -3981598, -3863447, -1262253, -2307074, 1758789, -3693476, 3384178, 1001696, -1979963, 4035492, 1055952, 621411, -2175379, -5020059, 2960289, 4078419, -3982120, -4800105, -2661865, -4757867, -1936650, 2947994, -1579416, -2226156, -1001561, 3995275, 3317576, 230370, -1848522, -3221260, 399190, -2602282, 2538847, -3678547, 3548984, -3790074, 2470676, -3955620, 586314, -4458233, 2196155, 3002857, 3049972, -1877135, 913479, -1256294, 4454547, -511065, 3200822, 1648884, 2586890, 4282188, 2592742, -3627135, -1961117, -3923773, -5011070, -4171664, 1854939, -3995678, 985941, 105167, 3210958, 1323523, -4649398, -1990551, -3307394, -2367522, -576824, 2017500, 2393873, 1962601, -477684, -233597, 4922508, -4609683, -154071, -4577142, 769099, -2674496, -749037, 2129720, -489490, 177653, 1768872, -2560569, 44853, 153964, -517853, -1635299, -2664189, 4741188, -3240704, 1233825, 3042836, 3914986, 4408469, 3835214, -1398913, -485838, -2679845, -406759, -778687, 690690, -1169437, -704519, 1734986, 1460130, 672934, 3697195, -2507866, -760847, 4264318, 1275320, -1094741, -2047017, 2358421, -1383892, 3558042, -3649920, 4622227, -4153984, 4106728, -1819910, -2820819, -534207, 833724, 1185621, 3910321, -2081957, -273053, -1518423, 506757, 2039134, -5012652, -98256, -1609143, 4173448, 2527973, -1672090, -3582323, -1694780, 1417403, -2375027, -2346956, 1390188, 108089, -847401, -1000721, 4876958, -4360838, 1028602, 1838531, 1591995, 3525172, -3032146, -3612042, -418845, -2710545, 1737387, -713362, 68220, -3394640, 734096
};
const int streamlined_Rmod_inv_GS_root_table[NTT_N << 1] = {
-2306475, -2306475, 472199, -2306475, 472199, -4615052, 2407952, -2306475, -2306475, 472199, -2306475, 472199, -4615052, 2407952, 472199, -4615052, 2407952, -4046753, -1267824, -1243860, -2297035, -4615052, -4046753, -1267824, 1996760, -315286, -3520751, 3612633, 2407952, -1243860, -2297035, -3693213, 3730163, -2154418, 888160, -4046753, 1996760, -315286, -1986537, -4447077, 1946952, 4670707, -1267824, -3520751, 3612633, -2377431, 3981072, -4669025, 4223018, -1243860, -3693213, 3730163, -2569528, -2223877, 1461373, -5019420, -2297035, -2154418, 888160, -4169220, -4925916, 642826, -162527, -2306475, -2306475, 472199, -2306475, 472199, -4615052, 2407952, 472199, -4615052, 2407952, -4046753, -1267824, -1243860, -2297035, -4615052, -4046753, -1267824, 1996760, -315286, -3520751, 3612633, 2407952, -1243860, -2297035, -3693213, 3730163, -2154418, 888160, -4046753, 1996760, -315286, -1986537, -4447077, 1946952, 4670707, -1267824, -3520751, 3612633, -2377431, 3981072, -4669025, 4223018, -1243860, -3693213, 3730163, -2569528, -2223877, 1461373, -5019420, -2297035, -2154418, 888160, -4169220, -4925916, 642826, -162527, 1996760, -1986537, -4447077, 418845, 4360838, 2375027, 1609143, -315286, 1946952, 4670707, 2081957, -4106728, 2047017, -672934, -3520751, -2377431, 3981072, 406759, -3042836, -153964, 749037, 3612633, -4669025, 4223018, 233597, 3307394, 3995678, -2592742, -3693213, -2569528, -2223877, 1256294, -586314, 2602282, 1001561, 3730163, 1461373, -5019420, 4800105, -1055952, 2307074, -1492521, -2154418, -4169220, -4925916, 267778, 880843, -1213221, -3377743, 888160, 642826, -162527, 3579629, 4093639, 704725, -4977846, -1986537, 418845, 4360838, -1737387, 2710545, -1838531, -1028602, -4447077, 2375027, 1609143, -1390188, 2346956, -2527973, -4173448, 1946952, 2081957, -4106728, 1518423, 273053, 2820819, 1819910, 4670707, 2047017, -672934, 1383892, -2358421, 2507866, -3697195, -2377431, 406759, -3042836, -690690, 778687, -4408469, -3914986, 3981072, -153964, 749037, 1635299, 517853, 489490, -2129720, -4669025, 233597, 3307394, 4609683, -4922508, 576824, 2367522, 4223018, 3995678, -2592742, -105167, -985941, 1961117, 3627135, -2569528, 1256294, -586314, 511065, -4454547, -2196155, 4458233, -2223877, 2602282, 1001561, 3678547, -2538847, -3317576, -3995275, 1461373, 4800105, -1055952, 4757867, 2661865, 2175379, -621411, -5019420, 2307074, -1492521, 3693476, -1758789, -3057304, -3853799, -4169220, 267778, 880843, -1386462, -3512589, -4386266, 1107830, -4925916, -1213221, -3377743, 3935604, -1087697, 2396236, -4645353, 642826, 3579629, 4093639, 1202185, -3311108, -2329122, 3715784, -162527, 704725, -4977846, -4021243, 188467, -2687317, -90240, 418845, -1737387, 2710545, -734096, 3394640, -68220, 713362, 4360838, -1838531, -1028602, 3612042, 3032146, -3525172, -1591995, 2375027, -1390188, 2346956, -4876958, 1000721, 847401, -108089, 1609143, -2527973, -4173448, -1417403, 1694780, 3582323, 1672090, 2081957, 1518423, 273053, 98256, 5012652, -2039134, -506757, -4106728, 2820819, 1819910, -3910321, -1185621, -833724, 534207, 2047017, 1383892, -2358421, 4153984, -4622227, 3649920, -3558042, -672934, 2507866, -3697195, 1094741, -1275320, -4264318, 760847, 406759, -690690, 778687, -1460130, -1734986, 704519, 1169437, -3042836, -4408469, -3914986, 2679845, 485838, 1398913, -3835214, -153964, 1635299, 517853, -1233825, 3240704, -4741188, 2664189, 749037, 489490, -2129720, -44853, 2560569, -1768872, -177653, 233597, 4609683, -4922508, 2674496, -769099, 4577142, 154071, 3307394, 576824, 2367522, 477684, -1962601, -2393873, -2017500, 3995678, -105167, -985941, 1990551, 4649398, -1323523, -3210958, -2592742, 1961117, 3627135, -1854939, 4171664, 5011070, 3923773, 1256294, 511065, -4454547, -4282188, -2586890, -1648884, -3200822, -586314, -2196155, 4458233, -913479, 1877135, -3049972, -3002857, 2602282, 3678547, -2538847, 3955620, -2470676, 3790074, -3548984, 1001561, -3317576, -3995275, -399190, 3221260, 1848522, -230370, 4800105, 4757867, 2661865, 2226156, 1579416, -2947994, 1936650, -1055952, 2175379, -621411, 3982120, -4078419, -2960289, 5020059, 2307074, 3693476, -1758789, -4035492, 1979963, -1001696, -3384178, -1492521, -3057304, -3853799, 1262253, 3863447, 3981598, -3743694, 267778, -1386462, -3512589, 4167396, -3274283, 412723, 4237798, 880843, -4386266, 1107830, 4884545, 3330522, 4776217, -4015034, -1213221, 3935604, -1087697, -3267915, 2391472, -153601, -1045367, -3377743, 2396236, -4645353, 2362576, -1106927, -1802607, 1153170, 3579629, 1202185, -3311108, -1872558, 26755, 161035, -4762669, 4093639, -2329122, 3715784, 4392087, 1695271, -1748518, 2618345, 704725, -4021243, 188467, -3630836, 1847281, -617303, 2940764, -4977846, -2687317, -90240, 238288, 357196, -799092, -157199
};

extern void __asm_ntt_Good_512x5(int*, const int*, int, int, int*);
extern void __asm_ntt_Good_512x5_small(int*, const int*, int, int, int*);
extern void __asm_ntt(int*, const int*, int, int);
extern void __asm_base_mul(int*, int*, int, int);
extern void __asm_intt(int*, const int*, int, int);
extern void __asm_final_map(int*, int, int, int, int*);
extern void __asm_final_map_n(int*, int*, int, int);

extern void ntt256_mod7681(int*, int*);
extern void ntt256_mod7681_basemul_10x10(int*, int*, int*);
extern void intt256_mod7681(int*, int*);
extern void crt_32bit_16bit(int*, int*, int*);

void polymul_1277x1277_mod7879(int* polyout, int* polyin1, int* polyin2);

void polymul_1277x1277_mod7879(int* polyout, int* polyin1, int* polyin2){
    int mem[5120];
    int *ntt1, *ntt2;
    ntt1 = mem;
    ntt2 = ntt1 + ARRAY_N;
    __asm_ntt_Good_512x5(ntt1, streamlined_Rmod_root_table, Mprime, MOD, polyin1);
    __asm_ntt_Good_512x5_small(ntt2, streamlined_Rmod_root_table, Mprime, MOD, polyin2);
    __asm_ntt(ntt1, streamlined_Rmod_root_table, Mprime, MOD);
    __asm_ntt(ntt2, streamlined_Rmod_root_table, Mprime, MOD);
    __asm_base_mul(ntt1, ntt2, Mprime, MOD);
    __asm_intt(ntt1, streamlined_Rmod_inv_GS_root_table, Mprime, MOD);
    __asm_final_map(ntt1, Mhalf, Mprime, MOD, polyout);
}
